(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{584:function(s,a,n){"use strict";n.r(a);var t=n(3),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("Boxx"),s._v(" "),n("h4",{attrs:{id:"elasticsearch"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[s._v("#")]),s._v(" ElasticSearch")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://imgtu.com/i/RhUWcR",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://z3.ax1x.com/2021/07/05/RhUWcR.md.png",alt:"RhUWcR.md.png"}}),n("OutboundLink")],1),s._v("\nmysql用作持久化存储，ES用作检索"),n("br"),s._v("\n基本概念：index库>type表>document文档"),n("br"),s._v(" "),n("strong",[s._v("index")]),s._v("\n动词：相当于mysql的insert"),n("br"),s._v("\n名词：相当于mysql的db"),n("br"),s._v(" "),n("strong",[s._v("type")]),s._v("\n在index中，可以定义一个或多个类型"),n("br"),s._v("\n类似于mysql的table，每一种类型的数据放在一起"),n("br"),s._v(" "),n("strong",[s._v("document")]),s._v("\n保存在某个index下，某种type的一个数据document，文档是json格式的，document就像是mysql中的某个table里面的内容。每一行对应的列叫属性"),n("br"),s._v(" "),n("strong",[s._v("问题")]),s._v("\n为什么elasticSearch查询快？倒排索引")]),s._v(" "),n("p",[s._v("关系型数据库中两个数据表示是独立的，即使他们里面有相同名称的列也不影响使用，但ES中不是这样的。elasticsearch是基于Lucene开发的搜索引擎，而ES中不同type下名称相同的filed最终在Lucene中的处理方式是一样的。\n两个不同type下的两个user_name，在ES同一个索引下其实被认为是同一个filed，你必须在两个不同的type中定义相同的filed映射。否则，不同type中的相同字段名称就会在处理中出现冲突的情况，导致Lucene处理效率下降。\n去掉type就是为了提高ES处理数据的效率。\nElasticsearch 7.xURL中的type参数为可选。比如，索引一个文档不再要求提供文档类型。\nElasticsearch 8.x不再支持URL中的type参数。\n解决：将索引从多类型迁移到单类型，每种类型文档一个独立索引")]),s._v(" "),n("h4",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("p",[s._v("查看虚拟机磁盘使用情况:  df -h")]),s._v(" "),n("ol",[n("li",[s._v("下载镜像")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载ealastic search（存储和检索）和kibana（可视化检索），版本必须统一")]),s._v("\ndocker pull elasticsearch:7.4.2\ndocker pull kibana:7.4.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("步骤二、创建挂载目录")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将docker里的目录挂载到linux的/mydata目录中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改/mydata就可以改掉docker里的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mydata/elasticsearch/config\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mydata/elasticsearch/data\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kibana")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /mydata/kibana/config\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# es可以被远程任何机器访问")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http.host: 0.0.0.0"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/mydata/elasticsearch/config/elasticsearch.yml\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 递归更改权限，es启动之后第二次查看会自动关机")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /mydata/elasticsearch/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看日志")]),s._v("\ndocker logs elasticsearch\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("启动")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 ES ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 9200是用户交互端口 9300是集群心跳端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -e指定是单阶段运行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -e指定占用的内存大小，生产时可以设置32G")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -v目录挂载映射")]),s._v("\ndocker run --name elasticsearch -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(":9200 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v(":9300 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovery.type=single-node"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ES_JAVA_OPTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms64m -Xmx512m"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v  /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d elasticsearch:7.4.2 \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机启动elasticsearch")]),s._v("\ndocker update elasticsearch --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动Kibana")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kibana指定了了ES交互端口9200,设置自己虚拟机IP  ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5601是kibana主页端口")]),s._v("\ndocker run --name kibana -e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ELASTICSEARCH_HOSTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://192.168.133.128:9200 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 -d kibana:7.4.2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将配置文件拷贝出来，后面做挂载")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" kibana:/usr/share/kibana/config/ /mydata/kibana/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mydata/kibana/config/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kibana.yml\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改elasticsearch.hosts为具体的IP地址")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://imgtu.com/i/RhYq9s",target:"_blank",rel:"noopener noreferrer"}},[n("img",{attrs:{src:"https://z3.ax1x.com/2021/07/05/RhYq9s.md.png",alt:"RhYq9s.md.png"}}),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先销毁容器")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f kibana\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#挂载运行 启动交互端口配置在kibana.yml 文件里面")]),s._v("\ndocker run --name kibana "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"I18N_LOCALE=zh-CN"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v(":5601 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d kibana:7.4.2\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机启动kibana")]),s._v("\ndocker update kibana  --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("验证")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#ES 返回JSON信息成功\nhttp://192.168.133.128:9200/\n#kibana 返回图形界面成功\nhttp://192.168.133.128:5601/app/kibana\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"ik分词器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ik分词器"}},[s._v("#")]),s._v(" ik分词器")]),s._v(" "),n("p",[s._v("下载安装包解压拖到挂载目录\n"),n("a",{attrs:{href:"https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.4.2",target:"_blank",rel:"noopener noreferrer"}},[s._v("ik分词器github"),n("OutboundLink")],1),s._v("\n解压放到 "),n("code",[s._v("/plugins/ik")]),s._v(" 目录下")])],1)}),[],!1,null,null,null);a.default=e.exports}}]);